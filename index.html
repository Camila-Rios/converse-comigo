
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simulador WhatsApp ‚Äî Interativo (Realista)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{--wa-green:#25D366;}
    html,body{height:100%}
    body{background:linear-gradient(180deg,#071322 0%,#021018 100%);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#fff}
    .frame{width: 100%;
  height: 100vh; /* full viewport height */
  border-radius: 0; /* sem bordas arredondadas no mobile */
  border: none;
  box-shadow: none;
  display: flex;
  flex-direction: column;}
    .top{position: sticky;
  top: 0;
  z-index: 10;
  padding: 12px;
  background: #075e54; /* verde WhatsApp */
  display: flex;
  align-items: center;}
    .avatar{width:44px;height:44px;border-radius:50%;overflow:hidden;border:2px solid rgba(255,255,255,.08)}
    .meta .name{font-weight:600}
    .messages{flex:1;padding:16px;overflow:auto;background-image:linear-gradient(to bottom, rgba(255,255,255,0.01), rgba(255,255,255,0.005));}
    .msg-row{display:flex;margin-bottom:10px;align-items:flex-end}
    .msg-row.me{justify-content:flex-end}
    .bubble{display:inline-block;padding:10px 14px;border-radius:18px;max-width:78%;line-height:1.3;font-size:14px;position:relative}
    .bubble.me{background:#dcf8c6;color:#06331f;border-bottom-right-radius:6px}
    .bubble.her{background:rgba(255,255,255,0.08);color:#fff;border-bottom-left-radius:6px}
    .typing{display:flex;align-items:center;gap:6px;padding:8px 10px;border-radius:18px;background:rgba(255,255,255,0.06);width:120px}
    .dot{width:6px;height:6px;background:#fff;border-radius:50%;animation:blink 1.2s infinite}
    .dot:nth-child(2){animation-delay:.12s}.dot:nth-child(3){animation-delay:.24s}
    @keyframes blink{0%{transform:translateY(0);opacity:.25}50%{transform:translateY(-4px);opacity:1}100%{transform:translateY(0);opacity:.25}}
    .composer{display:flex;gap:10px;padding:12px;background:linear-gradient(180deg,rgba(0,0,0,0.25),rgba(255,255,255,0.02));align-items:center}
    .btn{padding:9px 14px;border-radius:999px;font-weight:600}
    .btn-primary{background:var(--wa-green);color:#06331f}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff}
    .message-audio{display:flex;align-items:center;gap:10px;padding:8px 10px;background:rgba(0,0,0,0.12);border-radius:12px}
    .play-btn{width:40px;height:40px;border-radius:50%;display:grid;place-items:center;background:rgba(255,255,255,0.06);cursor:pointer;user-select:none}
    .play-btn.playing{background:linear-gradient(90deg,#25d366,#00a884);color:#032c22}
    .audio-meta{display:flex;flex-direction:column}
    .small{font-size:12px;opacity:.85}
    .quick-replies{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
    .quick-reply{background:rgba(255,255,255,0.06);padding:8px 10px;border-radius:999px;cursor:pointer;border:1px solid rgba(255,255,255,0.03)}
    .quick-reply:hover{background:rgba(255,255,255,0.09)}
    .modal-wrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);z-index:60}
    .modal{width:100%;max-width:880px;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));border-radius:14px;padding:14px;border:1px solid rgba(255,255,255,0.04);backdrop-filter: blur(6px)}
    .modal-grid{display:grid;grid-template-columns:1fr 360px;gap:14px}
    .preview-img{width:100%;height:100%;object-fit:cover;border-radius:10px}
    .pix-card{padding:12px;border-radius:10px;background:rgba(0,0,0,0.35);border:1px solid rgba(255,255,255,0.04)}
    .pix-qr{width:150px;height:150px;border-radius:8px;background:rgba(255,255,255,0.02);display:block}
    @media(max-width:880px){.modal-grid{grid-template-columns:1fr}}
    .bubble{transform:translateY(6px);opacity:0;animation:enter .28s forwards}
    @keyframes enter{to{transform:none;opacity:1}}
    .timestamp{font-size:11px;opacity:.7;margin-left:8px;display:block;margin-top:6px}
    /* small wave animation for playing state */
    .wave{width:36px;height:16px;display:inline-block;position:relative}
    .wave span{position:absolute;bottom:0;left:0;width:4px;height:6px;background:#fff;opacity:.7;border-radius:2px;animation:wave 800ms infinite ease-in-out}
    .wave span:nth-child(2){left:6px;animation-delay:100ms}
    .wave span:nth-child(3){left:12px;animation-delay:200ms}
    .wave span:nth-child(4){left:18px;animation-delay:300ms}
    .wave span:nth-child(5){left:24px;animation-delay:400ms}
    @keyframes wave{0%{height:6px;opacity:.6}50%{height:14px;opacity:1}100%{height:6px;opacity:.6}}
  </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

  <div class="frame" role="region" aria-label="Simulador WhatsApp - Interativo">
    <div class="top">
      <div class="avatar"><img id="modelAvatarTop" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop&crop=faces" alt="Camila" class="w-full h-full object-cover"></div>
      <div class="meta">
        <div class="name">Camila ‚ú®</div>
        <div class="small">online ‚Ä¢ √∫ltima vez h√° 2 min</div>
      </div>
      <div class="ml-auto text-right">
        <div class="text-xs">VIP ‚Ä¢ R$19,90</div>
      </div>
    </div>

    <div id="messages" class="messages" aria-live="polite"></div>

    <div class="composer" id="composerStatic">
      <div class="small text-white/80">Responda usando os bot√µes que aparecem nas mensagens.</div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal-wrap hidden" role="dialog" aria-modal="true" aria-label="Pr√©via e pagamento">
    <div class="modal">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-3">
          <div class="avatar" style="width:44px;height:44px"><img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=200&auto=format&fit=crop&crop=faces" alt="Camila" class="w-full h-full object-cover rounded-full"></div>
          <div>
            <div class="font-semibold">Camila</div>
            <div class="text-xs text-white/80">Pr√©via escolhida a dedo</div>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <button id="closeModal" class="btn btn-ghost">Fechar</button>
        </div>
      </div>

      <div class="modal-grid">
        <div class="rounded overflow-hidden">
          <img id="previewImage" src="https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=800&auto=format&fit=crop" alt="Pr√©via" class="preview-img">
        </div>

        <div class="flex flex-col gap-3">
          <div class="pix-card">
            <div class="flex items-center justify-between">
              <div>
                <div class="font-semibold">Pagar via PIX (recomendado)</div>
                <div class="text-xs text-white/80">R$19,90 ‚Ä¢ chave √∫nica gerada</div>
              </div>
              <div class="text-xs text-white/70">Seguro ‚Ä¢ Instant√¢neo</div>
            </div>

            <div class="mt-3 flex gap-3 items-start">
              <img id="pixQR" src="" alt="QR PIX" class="pix-qr" />
              <div class="flex-1">
                <div class="text-xs text-white/80">Chave PIX</div>
                <div id="pixKey" class="mono break-words text-sm mt-1 text-white">--</div>

                <div class="mt-3 flex gap-2">
                  <button id="copyKey" class="btn btn-ghost">Copiar</button>
                  <a id="downloadQR" download="pix-qr.png" class="btn btn-ghost">Baixar QR</a>
                </div>

                <div class="mt-3">
                  <button id="paidBtn" class="btn btn-primary">J√° paguei</button>
                  <button id="noPixBtn" class="btn btn-ghost ml-2">N√£o tenho PIX</button>
                </div>

                <div id="pixStatus" class="text-xs text-white/70 mt-3">Status: aguardando pagamento...</div>
              </div>
            </div>

          </div>

          <div class="text-xs text-white/80">Se n√£o conseguir pagar com PIX, finalize no checkout:</div>
          <a id="checkoutLink" href="#" class="btn btn-primary text-sm inline-block">Ir para checkout</a>

        </div>
      </div>

    </div>
  </div>

  <!-- Shared audio element (substitua src pelo seu MP3 real) -->
  <audio id="sharedAudio" src="https://www.w3schools.com/html/horse.mp3"></audio>

<script>
/* -----------------------------------------
   Simulador WhatsApp Interativo (Quick Replies + Audio Inline)
   - Quick replies: bot√µes que viram a resposta do usu√°rio
   - Audio plays inline (sharedAudio), no redirect
   - Conversa guiada: caminhos 'sim' e 'n√£o'
------------------------------------------*/

const messagesEl = document.getElementById('messages');
const sharedAudio = document.getElementById('sharedAudio');

// small helper: append a message bubble
function appendBubble(from, innerHTML, opts={withReplies: null, timestamp:true}) {
  const row = document.createElement('div');
  row.className = 'msg-row ' + (from==='me' ? 'me' : '');
  const bubble = document.createElement('div');
  bubble.className = 'bubble ' + (from==='me' ? 'me' : 'her');
  bubble.innerHTML = innerHTML;
  row.appendChild(bubble);

  // timestamp
  if(opts.timestamp) {
    const ts = document.createElement('span');
    ts.className = 'timestamp';
    const now = new Date();
    ts.textContent = now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    bubble.appendChild(ts);
  }

  messagesEl.appendChild(row);
  messagesEl.scrollTop = messagesEl.scrollHeight;

  // quick replies (array of {text, payload})
  if(Array.isArray(opts.withReplies) && opts.withReplies.length){
    const repliesWrap = document.createElement('div');
    repliesWrap.className = 'quick-replies';
    opts.withReplies.forEach(r=>{
      const btn = document.createElement('button');
      btn.className = 'quick-reply';
      btn.textContent = r.text;
      btn.addEventListener('click', ()=> {
        // remove quick replies and simulate user reply
        repliesWrap.remove();
        userReply(r.text, r.payload);
      });
      repliesWrap.appendChild(btn);
    });
    bubble.appendChild(repliesWrap);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }
  return row;
}

// typing indicator
function showTyping(min=500, max=1200){
  const row = document.createElement('div');
  row.className = 'msg-row';
  const t = document.createElement('div');
  t.className = 'typing';
  t.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
  row.appendChild(t);
  messagesEl.appendChild(row);
  messagesEl.scrollTop = messagesEl.scrollHeight;
  const delay = min + Math.random()*(max-min);
  return new Promise(res => setTimeout(()=> { row.remove(); res(); }, delay));
}

// play audio for a specific bubble's play button
function bindPlayButtons(){
  // Find all unbound play buttons
  document.querySelectorAll('.play-btn').forEach(btn => {
    if(btn.dataset.bound === 'true') return;
    btn.dataset.bound = 'true';
    btn.addEventListener('click', async (e)=>{
      const isPlaying = btn.classList.contains('playing');
      // stop any current playback first
      stopAllPlaying();
      if(isPlaying){
        // was playing, so now stop
        sharedAudio.pause();
        btn.classList.remove('playing');
        btn.innerHTML = '‚ñ∂';
        removeWave(btn);
        return;
      }
      // start playing sharedAudio from 0
      try {
        sharedAudio.currentTime = 0;
      } catch(e){ /* ignore */ }
      btn.classList.add('playing');
      btn.innerHTML = '‚ñÆ‚ñÆ';
      addWave(btn);
      // visual: show progress (simple)
      sharedAudio.play().catch(err => {
        // fallback: open in new tab if autoplay blocked (rare)
        console.warn('playback failed', err);
        window.open(sharedAudio.src, '_blank');
        btn.classList.remove('playing');
        btn.innerHTML = '‚ñ∂';
        removeWave(btn);
      });
      sharedAudio.onended = () => {
        btn.classList.remove('playing');
        btn.innerHTML = '‚ñ∂';
        removeWave(btn);
      };
    });
  });
}
function stopAllPlaying(){
  document.querySelectorAll('.play-btn.playing').forEach(btn => {
    btn.classList.remove('playing');
    btn.innerHTML = '‚ñ∂';
    removeWave(btn);
  });
  try { sharedAudio.pause(); } catch(e) {}
}
function addWave(btn){
  if(btn.querySelector('.wave')) return;
  const wave = document.createElement('span');
  wave.className = 'wave';
  wave.innerHTML = '<span></span><span></span><span></span><span></span><span></span>';
  btn.appendChild(wave);
}
function removeWave(btn){
  const w = btn.querySelector('.wave');
  if(w) w.remove();
}

/* -----------------------
   Conversation flow
   -----------------------*/

// initial sequence: model greets, sends audio message, then quick replies
async function initialSequence(){
  await showTyping(400,900);
  appendBubble('her', 'Oii amorzinho üíã acabei de gravar um √°udio s√≥ pra voc√™.');
  await showTyping(300,700);

  // audio bubble content (play button + meta)
  const audioHtml = `
    <div class="message-audio" aria-hidden="false">
      <div class="play-btn" role="button" aria-label="Tocar √°udio">‚ñ∂</div>
      <div class="audio-meta">
        <div class="small font-semibold">√Åudio de Camila ‚Ä¢ 0:12</div>
        <div class="small text-white/70">Toque para ouvir</div>
      </div>
    </div>
  `;
  appendBubble('her', audioHtml);

  // bind play btns
  bindPlayButtons();

  await showTyping(500,1000);
  // present quick replies (strategy: guide to conversion)
  appendBubble('her', 'Voc√™ prefere que eu mande a pr√©via agora ou quer um trechinho gr√°tis primeiro?', {
    withReplies: [
      {text: 'Quero ver agora üî•', payload: 'want_now'},
      {text: 'Quero s√≥ um trechinho', payload: 'trecho'},
      {text: 'Depois / N√£o', payload: 'no'}
    ]
  });
  bindPlayButtons();
}

// handle user's quick-reply selection (payload optional)
async function userReply(text, payload){
  // show user's bubble (green)
  appendBubble('me', text);

  // small delay then model response based on payload
  if(payload === 'want_now'){
    await showTyping(400,900);
    appendBubble('her', 'Ain que del√≠cia üòà vou liberar a pr√©via completa por R$19,90. Quer pagar via PIX (mais r√°pido) ou prefere checkout?');
    await showTyping(300,700);
    appendBubble('her', 'Escolha uma op√ß√£o:', {
      withReplies: [
        {text: 'PIX ‚Äî Quero VIP', payload: 'pix_flow'},
        {text: 'Ir para checkout', payload: 'checkout_flow'}
      ]
    });
  } else if(payload === 'trecho'){
    await showTyping(400,900);
    appendBubble('her', 'Ok, vou mandar um trechinho pra voc√™ agora ‚ù§');
    await showTyping(400,900);
    // send short teaser image + small audio again
    appendBubble('her', '<img src="https://images.unsplash.com/photo-1503023345310-bd7c1de61c7d?q=80&w=600&auto=format&fit=crop" class="rounded max-w-full"/>');
    await showTyping(400,900);
    appendBubble('her', 'Curtiu? Quer a vers√£o completa por R$19,90?', {
      withReplies: [
        {text: 'Quero sim üî•', payload: 'want_now'},
        {text: 'Ainda n√£o', payload: 'no'}
      ]
    });
  } else if(payload === 'no'){
    await showTyping(400,900);
    appendBubble('her', 'Tranquilo üòè se mudar de ideia me chama aqui. Posso te lembrar mais tarde?');
    appendBubble('her', 'Enquanto isso, posso mandar um mini trechinho gr√°tis para te convencer üòâ', {
      withReplies: [
        {text: 'Manda o trechinho', payload: 'trecho'},
        {text: 'N√£o, obrigada', payload: 'end'}
      ]
    });
  } else if(payload === 'pix_flow'){
    // open modal payment (PIX)
    await showTyping(300,700);
    appendBubble('her', 'Perfeito! Vou abrir as op√ß√µes de pagamento ‚Äî escolhe PIX que √© instant√¢neo e eu libero na hora.');
    openModal();
  } else if(payload === 'checkout_flow'){
    await showTyping(300,700);
    appendBubble('her', 'Beleza ‚Äî abrindo o checkout seguro pra voc√™ finalizar.');
    window.open(checkoutUrl, '_blank');
  } else if(payload === 'end'){
    await showTyping(300,700);
    appendBubble('her', 'Beleza, fico por aqui. Me chama quando quiser ‚ù§Ô∏è');
  } else {
    // fallback: generic response and offer options
    await showTyping(300,700);
    appendBubble('her', 'Haha adorei! Quer que eu libere a pr√©via completa por R$19,90?', {
      withReplies: [
        {text: 'Sim, libera', payload: 'pix_flow'},
        {text: 'N√£o agora', payload: 'no'}
      ]
    });
  }

  // re-bind any remaining play buttons
  bindPlayButtons();
}

/* ----------------------
   Modal + PIX logic
   ----------------------*/

const modalEl = document.getElementById('modal');
const closeModalBtn = document.getElementById('closeModal');
closeModalBtn.addEventListener('click', ()=> modalEl.classList.add('hidden'));

function openModal(){ modalEl.classList.remove('hidden'); generatePIX(); }

// PIX utils (demo)
function generateRandomKey(){
  const names = ['camila.vip','camila.exclusiva','contato.camila','camila.oficial'];
  return names[Math.floor(Math.random()*names.length)] + (Math.floor(Math.random()*900)+100) + '@exemplo.com';
}
function buildPixPayload(key, amount, txid){ return `PAY?key=${key}&amount=${amount}&txid=${txid}`; }

const pixKeyEl = document.getElementById('pixKey');
const pixQREl = document.getElementById('pixQR');
const downloadQR = document.getElementById('downloadQR');
let currentPixKey = '';
let currentTxId = '';
const checkoutUrl = 'https://seu-checkout-exemplo.com/checkout?product=vip19_90';

function generatePIX(){
  const key = generateRandomKey();
  const amount = '19.90';
  const txid = 'VIP' + Math.floor(Math.random()*900000+100000);
  currentPixKey = key; currentTxId = txid;
  pixKeyEl.textContent = key;
  const payload = buildPixPayload(key, amount, txid);
  const qrUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=' + encodeURIComponent(payload);
  pixQREl.src = qrUrl;
  downloadQR.href = qrUrl;
}
document.getElementById('copyKey').addEventListener('click', ()=> navigator.clipboard.writeText(currentPixKey).then(()=> toast('Chave PIX copiada')));
document.getElementById('paidBtn').addEventListener('click', ()=> {
  const pixStatus = document.getElementById('pixStatus');
  pixStatus.textContent = 'Verificando pagamento...';
  setTimeout(()=> {
    const paid = Math.random() < 0.62;
    if(paid){
      pixStatus.textContent = 'Pagamento confirmado ‚úÖ Liberando pr√©via...';
      setTimeout(()=> {
        appendBubble('her','Prontinho! Aqui est√° a pr√©via exclusiva ‚ù§Ô∏è');
        appendBubble('her','<img src="https://images.unsplash.com/photo-1503023345310-bd7c1de61c7d?q=80&w=600&auto=format&fit=crop" class="rounded max-w-full"/>');
        modalEl.classList.add('hidden');
      },700);
    } else {
      pixStatus.textContent = 'Pagamento n√£o encontrado. Voc√™ pode finalizar no checkout.';
      document.getElementById('checkoutLink').classList.remove('hidden');
    }
  },1200);
});
document.getElementById('noPixBtn').addEventListener('click', ()=> window.open(checkoutUrl,'_blank'));
document.getElementById('checkoutLink').href = checkoutUrl;

/* ----------------------
   Helpers: toast
   ----------------------*/
function toast(text){
  const t = document.createElement('div');
  t.textContent = text;
  t.style.position='fixed'; t.style.left='50%'; t.style.transform='translateX(-50%)';
  t.style.bottom='28px'; t.style.padding='10px 14px'; t.style.borderRadius='999px';
  t.style.background='rgba(0,0,0,0.6)'; t.style.color='#fff'; t.style.zIndex=9999; t.style.fontSize='13px';
  document.body.appendChild(t);
  setTimeout(()=> t.style.opacity = '0',1800);
  setTimeout(()=> t.remove(),2300);
}

/* ----------------------
   Start
   ----------------------*/
initialSequence();

</script>
</body>
</html>
